# 🧪 测试步骤

## ✅ 修复完成

已修复消息格式不匹配的问题：
- `popup.js` 使用 `type` 字段
- `background_offscreen.js` 现在同时支持 `type` 和 `action` 字段

---

## 🚀 测试步骤

### 1. 重新加载扩展

1. 打开 `chrome://extensions/`
2. 找到 "智能书签搜索" 扩展
3. 点击 "重新加载" (刷新图标)

### 2. 打开 Service Worker Console

1. 在扩展卡片上点击 "service worker"
2. 会打开 DevTools
3. 查看 Console 日志

### 3. 点击扩展图标

点击浏览器工具栏上的扩展图标

### 4. 观察初始化过程

应该看到以下日志：

#### Service Worker Console:
```
🚀 Background Service Worker 启动（Offscreen Document 模式）
📨 收到请求: GET_INIT_STATUS
📨 收到请求: INITIALIZE_ENGINE
✅ Offscreen Document 已创建
🚀 开始初始化语义搜索引擎...
✅ Offscreen Document 模型加载完成
📚 找到 XX 个书签
🔑 书签签名: xxxx...
📊 开始编码 XX 个书签...
✅ 成功编码 XX 个书签
💾 语义索引已保存到 IndexedDB
✅ 语义索引构建完成
```

#### Offscreen Document Console:
（如果有 Offscreen Document 的 DevTools）
```
🚀 Offscreen Document 启动
✅ 完整 DOM 环境可用
📥 加载 Sentence-BERT 模型...
模型下载: 15%
模型下载: 50%
模型下载: 100%
✅ Sentence-BERT 模型加载完成
```

### 5. 测试搜索

在 Popup 中输入：
```
排解忧虑
```

应该看到相关的书签结果。

---

## 🐛 如果还有问题

### 检查点 1: Service Worker 是否启动？
```
chrome://extensions/
→ 查看 "service worker" 链接是否存在
→ 点击查看是否有日志
```

### 检查点 2: 是否有错误？
查看 Service Worker Console 中是否有红色错误信息。

### 检查点 3: Offscreen Document 是否创建？
在 Service Worker Console 中应该看到：
```
✅ Offscreen Document 已创建
```

### 检查点 4: 模型是否下载？
如果网络较慢，模型下载可能需要几分钟。

### 检查点 5: Chrome 版本
确保 Chrome 版本 >= 109（Offscreen API 最低要求）

---

## 📝 常见错误和解决方案

### 错误 1: "初始化检查失败"
**原因**: 消息格式不匹配（已修复）

**解决**: 重新加载扩展

### 错误 2: "Creating offscreen document failed"
**原因**: Chrome 版本过低

**解决**: 升级 Chrome 到 109+

### 错误 3: 模型下载失败
**原因**: 网络问题

**解决**: 
1. 检查网络连接
2. 等待重试
3. 查看 Console 的详细错误信息

### 错误 4: "URL.createObjectURL is not a function"
**原因**: 应该不会再出现（使用 Offscreen Document）

**如果出现**: 
1. 确认 manifest.json 中 service_worker 是 `background_offscreen.js`
2. 确认 `offscreen` 权限已添加

---

## 🎯 预期结果

### 首次初始化（3-5分钟）
1. ✅ Offscreen Document 创建成功
2. ✅ 模型下载完成
3. ✅ 所有书签编码完成
4. ✅ 保存到 IndexedDB

### 后续使用（<1秒）
1. ✅ 从 IndexedDB 加载缓存
2. ✅ 秒级启动

### 搜索测试
输入 "排解忧虑"，应该返回：
- 冥想相关的书签
- 心理健康相关的书签
- 压力管理相关的书签

---

## 📸 截图位置

如果遇到问题，请截图：
1. Service Worker Console
2. Popup 界面
3. 错误信息

---

**现在重新加载扩展试试！** 🚀

